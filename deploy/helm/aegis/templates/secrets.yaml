# NOTE: In production, use external secrets management (AWS Secrets Manager, Vault)
# This template is for reference only

{{- if not .Values.api.externalSecrets.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: aegis-secrets
  labels:
    {{- include "aegis.labels" . | nindent 4 }}
type: Opaque
stringData:
  # IMPORTANT: Replace these with actual secrets in production
  # Use: kubectl create secret generic aegis-secrets --from-literal=...
  secret-key: "CHANGE-ME-IN-PRODUCTION-USE-RANDOM-STRING"
  jwt-secret: "CHANGE-ME-IN-PRODUCTION-USE-RANDOM-STRING"
  postgres-password: "CHANGE-ME-IN-PRODUCTION"
  redis-password: "CHANGE-ME-IN-PRODUCTION"
{{- end }}

---

# External Secrets Operator configuration (recommended for production)
{{- if .Values.api.externalSecrets.enabled }}
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: aegis-secrets
  labels:
    {{- include "aegis.labels" . | nindent 4 }}
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secrets-manager
    kind: ClusterSecretStore
  target:
    name: aegis-secrets
    creationPolicy: Owner
  data:
    - secretKey: secret-key
      remoteRef:
        key: aegis/production
        property: secret-key
    - secretKey: jwt-secret
      remoteRef:
        key: aegis/production
        property: jwt-secret
    - secretKey: postgres-password
      remoteRef:
        key: aegis/production
        property: postgres-password
    - secretKey: redis-password
      remoteRef:
        key: aegis/production
        property: redis-password
{{- end }}
